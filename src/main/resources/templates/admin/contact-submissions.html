<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>聯絡表單管理 - DN車隊</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="/admin">DN車隊管理後台</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">返回前台</a>
            </div>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <!-- 側邊欄 -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="/admin">
                                <i class="bi bi-house"></i> 儀表板
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/navigation">
                                <i class="bi bi-list"></i> 導航欄管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/content">
                                <i class="bi bi-file-text"></i> 網站內容
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/images">
                                <i class="bi bi-image"></i> 圖片管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/team">
                                <i class="bi bi-people"></i> 團隊成員
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/events">
                                <i class="bi bi-calendar-event"></i> 隊聚活動
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/statistics">
                                <i class="bi bi-graph-up"></i> 統計數據
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/contact/submissions">
                                <i class="bi bi-envelope"></i> 聯絡表單
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- 主要內容 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">聯絡表單管理</h1>
                </div>

                <!-- 篩選器 -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <div class="btn-group" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="filterSubmissions('all')">全部</button>
                            <button type="button" class="btn btn-outline-warning" onclick="filterSubmissions('unprocessed')">未處理</button>
                            <button type="button" class="btn btn-outline-success" onclick="filterSubmissions('processed')">已處理</button>
                        </div>
                    </div>
                </div>

                <!-- 聯絡表單列表 -->
                <div class="card shadow">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>姓名</th>
                                        <th>Email</th>
                                        <th>主旨</th>
                                        <th>提交時間</th>
                                        <th>狀態</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="submission : ${submissions}">
                                        <td th:text="${submission.id}">1</td>
                                        <td th:text="${submission.name}">張三</td>
                                        <td th:text="${submission.email}">zhang@example.com</td>
                                        <td th:text="${submission.subject}">入隊申請</td>
                                        <td th:text="${#dates.format(submission.createdAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 10:00</td>
                                        <td>
                                            <span th:if="${submission.isProcessed}" class="badge bg-success">已處理</span>
                                            <span th:unless="${submission.isProcessed}" class="badge bg-warning">未處理</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-info" onclick="viewSubmission([[${submission.id}]])">
                                                <i class="bi bi-eye"></i> 查看
                                            </button>
                                            <button th:if="${!submission.isProcessed}" 
                                                    class="btn btn-sm btn-success" 
                                                    onclick="markAsProcessed([[${submission.id}]])">
                                                <i class="bi bi-check"></i> 標記已處理
                                            </button>
                                            <button class="btn btn-sm btn-danger" onclick="deleteSubmission([[${submission.id}]])">
                                                <i class="bi bi-trash"></i> 刪除
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 查看詳情Modal -->
    <div class="modal fade" id="viewModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">聯絡表單詳情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="submissionDetails">
                    <!-- 詳情內容將通過JavaScript動態載入 -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function viewSubmission(id) {
            // 這裡可以實作查看詳情的功能
            // 可以通過AJAX載入詳細資訊
            document.getElementById('submissionDetails').innerHTML = 
                '<p>載入中...</p><p>這裡會顯示聯絡表單的詳細資訊，包括姓名、Email、留言內容等。</p>';
            
            const modal = new bootstrap.Modal(document.getElementById('viewModal'));
            modal.show();
        }

        function markAsProcessed(id) {
            if (confirm('確定要標記為已處理嗎？')) {
                fetch('/contact/mark-processed/' + id, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('已標記為已處理');
                        location.reload();
                    } else {
                        alert('操作失敗：' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('操作失敗');
                });
            }
        }

        function deleteSubmission(id) {
            if (confirm('確定要刪除這筆聯絡表單嗎？此操作無法復原。')) {
                fetch('/contact/delete/' + id, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('已刪除');
                        location.reload();
                    } else {
                        alert('刪除失敗：' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('刪除失敗');
                });
            }
        }

        function filterSubmissions(type) {
            // 這裡可以實作篩選功能
            console.log('篩選類型：', type);
            // 可以通過AJAX重新載入表格資料
        }
    </script>
</body>
</html>
